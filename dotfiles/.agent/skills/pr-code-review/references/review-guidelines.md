# コードレビューガイドライン

各観点における詳細なチェックポイント。

## 1. セキュリティ

### 1.1 入力値バリデーション
- ユーザー入力は適切にサニタイズされているか
- 型チェック、長さ制限、形式チェックが行われているか
- ホワイトリスト方式が採用されているか（可能な場合）

### 1.2 インジェクション脆弱性
- **SQL**: パラメータ化クエリ/プリペアドステートメントを使用しているか
- **XSS**: 出力エスケープが適切か、CSPが設定されているか
- **コマンド**: シェルコマンドの組み立てにユーザー入力を直接使用していないか
- **パス**: パストラバーサル攻撃への対策があるか

### 1.3 認証・認可
- 認証が必要なエンドポイントで適切に検証されているか
- 認可チェックがリソースアクセス前に行われているか
- セッション管理が安全か

### 1.4 機密情報
- APIキー、パスワード、トークンがハードコードされていないか
- ログに機密情報が出力されていないか
- 環境変数や設定ファイルで適切に管理されているか

## 2. パフォーマンス

### 2.1 データベース
- N+1クエリ問題がないか
- 適切なインデックスが使用されているか
- 不要なカラムを取得していないか（SELECT *の使用）
- クエリが最適化されているか

### 2.2 ループと計算
- ループ内で重い処理や同じ計算を繰り返していないか
- 早期リターンで不要な処理をスキップしているか
- 計算結果のキャッシュを検討すべきか

### 2.3 メモリ
- 大きなデータセットを一度にメモリに読み込んでいないか
- ストリーム処理やページネーションが適切か
- メモリリークの可能性はないか

### 2.4 非同期処理
- 並列実行可能な処理が直列になっていないか
- async/awaitの使用が適切か
- デッドロックの可能性はないか

## 3. 可読性・保守性

### 3.1 命名
- 変数名、関数名が意図を明確に表しているか
- 命名規則がプロジェクト全体で一貫しているか
- 略語の使用は適切か

### 3.2 関数・クラス設計
- 単一責任原則に従っているか
- 関数が適切な長さか（目安: 30行以内）
- パラメータの数が多すぎないか（目安: 5個以内）

### 3.3 コードの重複
- DRY原則に違反していないか
- 共通化すべきコードはないか
- 過度な抽象化になっていないか

### 3.4 コメント
- 複雑なロジックに説明があるか
- 「なぜ（Why）」を説明しているか（「何を（What）」ではなく）
- 古いコメントが残っていないか

## 4. エラーハンドリング

### 4.1 例外処理
- 適切な粒度で例外をキャッチしているか
- 全てをキャッチする広範な例外処理を避けているか
- 例外を握りつぶしていないか

### 4.2 エラーメッセージ
- ユーザーに適切なエラーメッセージを返しているか
- ログに十分な情報が記録されているか
- 機密情報がエラーメッセージに含まれていないか

### 4.3 リソース管理
- ファイル、接続などのリソースが確実にクローズされているか
- try-finally/with文/deferなどが適切に使用されているか

## 5. テスト

### 5.1 カバレッジ
- 追加/変更されたコードにテストがあるか
- 主要なパスがテストされているか
- エッジケースが考慮されているか

### 5.2 テスト品質
- テストが独立しているか（他のテストに依存していないか）
- テスト名が何をテストしているか明確か
- アサーションが適切か

### 5.3 モック
- モックの使用が適切か（過度でないか）
- 外部依存が適切に分離されているか

## 6. 言語固有のチェックポイント

### Python
- 型ヒントが適切に使用されているか
- f-stringが適切に使用されているか
- `with`文でリソース管理されているか
- リスト内包表記の可読性

### JavaScript/TypeScript
- TypeScriptの型定義が適切か
- `any`型の使用を避けているか
- nullチェックが適切か
- Promiseのエラーハンドリング

### Go
- エラーが適切に処理されているか（`_ = err`を避ける）
- goroutineのリークがないか
- deferの順序が正しいか
- context.Contextの適切な伝播

### Java
- Null安全が考慮されているか
- リソースのtry-with-resources
- ストリームAPIの適切な使用
- 不変オブジェクトの活用

## 7. 指摘の重要度分類

### 🔴 Critical（要修正）
- セキュリティ脆弱性
- データ損失の可能性
- 本番環境での障害リスク
- 明らかなバグ

### 🟡 Warning（要確認）
- パフォーマンス問題
- エラーハンドリング不足
- 潜在的なバグ
- テスト不足

### 🟢 Suggestion（提案）
- 可読性の改善
- ベストプラクティスへの準拠
- コードスタイル
- リファクタリング提案
